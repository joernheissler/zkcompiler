G = Z_add_n (509);
Gx2 = (G, G);
Gx8 = (G, G, G, G, G, G, G, G);
H = Z_mul_n (1019, qr);
Hx5 = (H, H, H, H, H);

Gx8: W; /* w1,w2,w3,p,p1,p2,p3,p4 */
H: d = 811,  e = 442,  f = 565,  g = 616,  h = 187,  i = 346;
Hx5: X;

phi_W [ Gx2 -> Gx8 ] =
    [?G, ?G]                            /* (p1, p2)                              */
    :  [$.0,                            /* w1                                    */
        $.1,                            /* w2                                    */
        $.0 ^ $.1,                      /* w3 = w1 * w2                          */
        ?G,                             /* p = random                            */
        #.0,                            /* p1 = random                           */
        ?G,                             /* p2 = random                           */
        #.1,                            /* p3 = random                           */
        #.0 ^ $.1 : ##.1 - #];          /* p4 = p2 - p1 * w2                     */

phi_W_X [ Gx8 -> Hx5 ] =
       [h ^ $.2, i ^ $.6]               /* (h ^ w3, i ^ p3)                      */
    :  [#.0 + #.1,                      /* h ^ w3 * i ^ p3                       */
          d ^ $.0,                      /* d ^ w1                                */
          e ^ $.1,                      /* e ^ w2                                */
          f ^ $.2,                      /* f ^ w3                                */
          g ^ $.3,                      /* g ^ p                                 */
          h ^ $.0,                      /* h ^ w1                                */
          h ^ $.1,                      /* h ^ w2                                */
          i ^ $.4,                      /* i ^ p1                                */
          i ^ $.5]                      /* i ^ p2                                */
     : [#.1 + #.2 + #.3 + #.4,          /* x  = d ^ w1 * e ^ w2 * f ^ w3 * g ^ p */
        #.5 + #.7,                      /* x1 = h ^ w1 * i ^ p1                  */
        #.6 + #.8,                      /* x2 = h ^ w2 * i ^ p2                  */
        #.0,                            /* x3 = h ^ w3 * i ^ p3                  */
        #.0];                           /* x3 = h ^ w3 * i ^ p3                  */

phi [ Gx8 -> Hx5 ] =
       [d ^ $.0,                        /*  d ^ w1                               */
        e ^ $.1,                        /*  e ^ w2                               */
        f ^ $.2,                        /*  f ^ w3                               */
        g ^ $.3,                        /*  g ^ p                                */
        h ^ $.0,                        /*  h ^ w1                               */
        h ^ $.1,                        /*  h ^ w2                               */
        h ^ $.2,                        /*  h ^ w3                               */
      X.1 ^ $.1,                        /* x1 ^ w2                               */
        i ^ $.4,                        /*  i ^ p1                               */
        i ^ $.5,                        /*  i ^ p2                               */
        i ^ $.6,                        /*  i ^ p3                               */
        i ^ $.7]                        /*  i ^ p4                               */
    :[#.0 + #.1 + #.2 + #.3,            /*  d ^ w1 * e ^ w2 * f ^ w3 * g ^ p     */
      #.4 + #.8,                        /*  h ^ w1 * i ^ p1                      */
      #.5 + #.9,                        /*  h ^ w2 * i ^ p2                      */
      #.6 + #.10,                       /*  h ^ w3 * i ^ p3                      */
      #.7 + #.11];                      /* x1 ^ w2 * i ^ p4                      */
sigma = SigmaPhi[phi, X, W, 509];
